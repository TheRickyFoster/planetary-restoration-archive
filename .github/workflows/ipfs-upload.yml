name: ♻️ Upload to IPFS via NFT.Storage

on:
  push:
    branches:
      - main
    paths:
      - 'planetary-restoration-archive/**'

jobs:
  upload-to-ipfs:
    runs-on: ubuntu-latest
    steps:
      - name: 🧬 Checkout repo
        uses: actions/checkout@v3

      - name: 🗂️ List files for debug
        run: ls -lah

      - name: 📦 Zip the archive folder
        run: |
          cd $GITHUB_WORKSPACE
          zip -r archive.zip planetary-restoration-archive

      - name: 📡 Upload to NFT.Storage
        env:
          NFT_STORAGE_API_KEY: ${{ secrets.NFT_STORAGE_API_KEY }}
        run: |
          curl -X POST https://api.nft.storage/upload \
            -H "Authorization: Bearer $NFT_STORAGE_API_KEY" \
            -H "Content-Type: application/zip" \
            --data-binary @archive.zip \
            --fail \
            | jq

      - name: ✅ Done
        run: echo "Upload complete. Check above for CID."
